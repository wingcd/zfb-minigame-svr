# 管理员管理模块

## 1. 模块概述

管理员管理模块负责管理员账户的创建、删除、修改、查询以及角色权限管理等功能。

### 1.1 主要功能
- 管理员账户CRUD操作
- 角色权限管理
- 登录日志查询
- 操作审计

### 1.2 涉及云函数
- `adminLogin` - 管理员登录
- `createAdmin` - 创建管理员
- `updateAdmin` - 更新管理员信息
- `deleteAdmin` - 删除管理员
- `getAdminList` - 获取管理员列表
- `getAdminInfo` - 获取管理员详情

---

## 2. 接口详情

### 2.1 管理员登录

#### adminLogin
**功能**: 管理员登录验证  
**权限**: 无需权限验证

**输入参数**:
| 参数名 | 类型 | 必选 | 说明 |
| --- | --- | --- | --- |
| username | string | 是 | 用户名 |
| password | string | 是 | 密码 |
| rememberMe | boolean | 否 | 记住我（默认：false） |

**输出结果**:
```json
{
    "code": 0,
    "msg": "登录成功",
    "timestamp": 1603991234567,
    "data": {
        "token": "abc123def456ghi789",
        "tokenExpire": "2023-11-01T10:00:00.000Z",
        "adminInfo": {
            "id": "admin_id_123456",
            "username": "admin",
            "nickname": "系统管理员",
            "role": "super_admin",
            "roleName": "超级管理员",
            "permissions": ["admin_manage", "role_manage", "app_manage"],
            "email": "admin@example.com",
            "phone": "13800138000",
            "lastLoginTime": "2023-09-30T15:30:00.000Z",
            "createTime": "2023-09-01T10:00:00.000Z"
        }
    }
}
```

**错误码**:
- 4001: 用户名或密码错误
- 4003: 账户被锁定
- 5001: 服务器内部错误

---

### 2.2 创建管理员

#### createAdmin
**功能**: 创建新管理员账户  
**权限**: 需要 admin_manage 权限

**输入参数**:
| 参数名 | 类型 | 必选 | 说明 |
| --- | --- | --- | --- |
| username | string | 是 | 用户名（3-20个字符） |
| password | string | 是 | 密码（至少6个字符） |
| nickname | string | 否 | 昵称（默认同用户名） |
| role | string | 否 | 角色代码（默认：viewer） |
| email | string | 否 | 邮箱地址 |
| phone | string | 否 | 手机号码 |

**角色类型**:
- super_admin: 超级管理员
- admin: 管理员  
- operator: 运营人员
- viewer: 查看者

**输出结果**:
```json
{
    "code": 0,
    "msg": "创建成功",
    "timestamp": 1603991234567,
    "data": {
        "id": "admin_id_123456",
        "username": "testadmin",
        "nickname": "测试管理员",
        "role": "admin",
        "status": "active",
        "createTime": "2023-10-01T10:00:00.000Z"
    }
}
```

**错误码**:
- 4001: 参数错误或无效角色
- 4002: 用户名或邮箱已存在
- 4003: 权限不足
- 4004: 指定角色不存在

---

### 2.3 更新管理员

#### updateAdmin
**功能**: 更新管理员信息  
**权限**: 需要 admin_manage 权限

**输入参数**:
| 参数名 | 类型 | 必选 | 说明 |
| --- | --- | --- | --- |
| id | string | 是 | 管理员ID |
| nickname | string | 否 | 昵称 |
| role | string | 否 | 角色代码 |
| email | string | 否 | 邮箱地址 |
| phone | string | 否 | 手机号码 |
| status | string | 否 | 状态（active/disabled） |
| password | string | 否 | 新密码 |

**输出结果**:
```json
{
    "code": 0,
    "msg": "更新成功",
    "timestamp": 1603991234567,
    "data": {
        "id": "admin_id_123456",
        "username": "testadmin",
        "nickname": "新昵称",
        "role": "operator",
        "status": "active",
        "updateTime": "2023-10-01T10:00:00.000Z"
    }
}
```

**错误码**:
- 4001: 参数错误
- 4003: 权限不足或不能修改自己的角色
- 4004: 管理员不存在

---

### 2.4 删除管理员

#### deleteAdmin
**功能**: 删除管理员账户  
**权限**: 需要 admin_manage 权限（仅超级管理员）

**输入参数**:
| 参数名 | 类型 | 必选 | 说明 |
| --- | --- | --- | --- |
| id | string | 是 | 要删除的管理员ID |

**输出结果**:
```json
{
    "code": 0,
    "msg": "删除成功",
    "timestamp": 1603991234567,
    "data": {
        "deletedAdmin": {
            "id": "admin_id_123456",
            "username": "testadmin",
            "nickname": "测试管理员"
        }
    }
}
```

**错误码**:
- 4001: 参数错误
- 4003: 权限不足、不能删除自己或最后一个超级管理员
- 4004: 管理员不存在

---

### 2.5 获取管理员列表

#### getAdminList
**功能**: 获取管理员列表  
**权限**: 需要 admin_view 权限

**输入参数**:
| 参数名 | 类型 | 必选 | 说明 |
| --- | --- | --- | --- |
| page | number | 否 | 页码（默认：1） |
| limit | number | 否 | 每页数量（默认：20） |
| role | string | 否 | 角色筛选 |
| status | string | 否 | 状态筛选 |
| keyword | string | 否 | 关键词搜索（用户名/昵称） |

**输出结果**:
```json
{
    "code": 0,
    "msg": "查询成功",
    "timestamp": 1603991234567,
    "data": {
        "list": [
            {
                "id": "admin_id_123456",
                "username": "admin",
                "nickname": "系统管理员",
                "role": "super_admin",
                "roleName": "超级管理员",
                "status": "active",
                "email": "admin@example.com",
                "phone": "13800138000",
                "lastLoginTime": "2023-10-01T08:30:00.000Z",
                "createTime": "2023-09-01T10:00:00.000Z"
            }
        ],
        "total": 5,
        "page": 1,
        "limit": 20,
        "totalPages": 1
    }
}
```

---

### 2.6 获取管理员详情

#### getAdminInfo
**功能**: 获取管理员详细信息  
**权限**: 需要 admin_view 权限

**输入参数**:
| 参数名 | 类型 | 必选 | 说明 |
| --- | --- | --- | --- |
| id | string | 是 | 管理员ID |

**输出结果**:
```json
{
    "code": 0,
    "msg": "查询成功",
    "timestamp": 1603991234567,
    "data": {
        "adminInfo": {
            "id": "admin_id_123456",
            "username": "admin",
            "nickname": "系统管理员",
            "role": "super_admin",
            "roleName": "超级管理员",
            "permissions": ["admin_manage", "role_manage", "app_manage"],
            "status": "active",
            "email": "admin@example.com",
            "phone": "13800138000",
            "lastLoginTime": "2023-10-01T08:30:00.000Z",
            "lastLoginIp": "192.168.1.100",
            "loginCount": 156,
            "createTime": "2023-09-01T10:00:00.000Z"
        },
        "loginLogs": [
            {
                "time": "2023-10-01T08:30:00.000Z",
                "ip": "192.168.1.100",
                "userAgent": "Mozilla/5.0...",
                "result": "SUCCESS"
            }
        ]
    }
}
```

---

## 3. 角色权限说明

### 3.1 角色层级
1. **super_admin** - 超级管理员
   - 所有权限（*）
   - 可管理其他管理员

2. **admin** - 管理员
   - 应用管理、用户管理、配置管理
   - 不能管理管理员账户

3. **operator** - 运营人员
   - 用户管理、数据查看、邮件发送
   - 有限的配置修改权限

4. **viewer** - 查看者
   - 只读权限
   - 可查看统计数据和日志

### 3.2 权限码说明
- `admin_manage`: 管理员管理
- `role_manage`: 角色管理
- `app_manage`: 应用管理
- `user_manage`: 用户管理
- `config_manage`: 配置管理
- `data_view`: 数据查看
- `mail_send`: 邮件发送

---

## 4. 业务规则

### 4.1 账户规则
- 用户名必须唯一，3-20个字符
- 密码至少6个字符，包含字母和数字
- 邮箱地址必须唯一且格式正确
- 手机号码格式验证

### 4.2 权限规则
- 超级管理员可以管理所有账户
- 管理员不能创建/修改超级管理员
- 不能删除自己的账户
- 必须保留至少一个超级管理员

### 4.3 安全规则
- 连续登录失败5次锁定账户30分钟
- 密码修改后强制重新登录
- 删除账户前需要确认权限

---

## 5. 错误码汇总

| 错误码 | 说明 |
| --- | --- |
| 4001 | 参数错误/认证失败 |
| 4002 | 资源已存在 |
| 4003 | 权限不足/业务限制 |
| 4004 | 资源不存在 |
| 5001 | 服务器内部错误 |
